name: Documentation

on:
  push:
    branches: [main]
    paths:
      - '**.md'
      - 'code-executor/**.md'
  pull_request:
    paths:
      - '**.md'
      - 'code-executor/**.md'

jobs:
  check-docs:
    name: Check Documentation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check markdown formatting
        uses: DavidAnson/markdownlint-cli2-action@v15
        continue-on-error: true  # Don't fail on markdown formatting issues
        with:
          globs: '**/*.md'

      - name: Check code blocks are valid
        run: |
          # Extract TypeScript code blocks and check syntax
          for md_file in *.md code-executor/*.md; do
            echo "Checking $md_file..."

            # This is a simple check - you might want a more robust solution
            grep -Pzo '```typescript\n\K(.|\n)*?(?=```)' "$md_file" || true
          done

      - name: Verify all referenced scripts exist
        run: |
          # Check that all core scripts exist
          echo "Checking TypeScript scripts..."
          for script in multi-tool-workflow parallel-execution error-recovery file-processing conditional-logic data-aggregation; do
            if [ ! -f "code-executor/scripts/typescript/${script}.ts" ]; then
              echo "✗ Missing: scripts/typescript/${script}.ts"
              exit 1
            fi
          done

          echo "Checking Python scripts..."
          for script in multi_tool_workflow parallel_execution error_recovery file_processing conditional_logic data_aggregation; do
            if [ ! -f "code-executor/scripts/python/${script}.py" ]; then
              echo "✗ Missing: scripts/python/${script}.py"
              exit 1
            fi
          done

          echo "✓ All scripts exist"
